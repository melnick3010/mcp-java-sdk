[melnick3010@k8snv41 mcp-java-sdk]$ ~/mvn8    -pl mcp-core -Dtest=io.modelcontextprotocol.server.HttpServletSseIntegrationTests#testInitializeHandshake   test
[INFO] Scanning for projects...
[INFO]
[INFO] ----------------< io.modelcontextprotocol.sdk:mcp-core >----------------
[INFO] Building Java MCP SDK Core 0.17.0-SNAPSHOT
[INFO] --------------------------------[ jar ]---------------------------------
[INFO]
[INFO] --- spring-javaformat-maven-plugin:0.0.28:validate (default) @ mcp-core ---
[INFO]
[INFO] --- maven-enforcer-plugin:3.5.0:enforce (enforce-java-and-bytecode) @ mcp-core ---
[INFO] Rule 0: org.apache.maven.enforcer.rules.version.RequireJavaVersion passed
[INFO] Rule 1: org.codehaus.mojo.extraenforcer.dependencies.EnforceBytecodeVersion passed
[INFO]
[INFO] --- maven-dependency-plugin:3.8.0:properties (default) @ mcp-core ---
[INFO]
[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ mcp-core ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] skip non existing resourceDirectory /home/melnick3010/mcp-java-sdk/mcp-core/src/main/resources
[INFO]
[INFO] --- flatten-maven-plugin:1.5.0:flatten (flatten) @ mcp-core ---
[INFO] Generating flattened POM of project io.modelcontextprotocol.sdk:mcp-core:jar:0.17.0-SNAPSHOT...
[INFO]
[INFO] --- maven-compiler-plugin:3.11.0:compile (java-compile) @ mcp-core ---
[INFO] Changes detected - recompiling the module! :source
[INFO] Compiling 72 source files with javac [debug target 1.8] to target/classes
[WARNING] unknown enum constant javax.annotation.meta.When.MAYBE
  reason: class file for javax.annotation.meta.When not found
[INFO] /home/melnick3010/mcp-java-sdk/mcp-core/src/main/java/io/modelcontextprotocol/server/McpAsyncServerExchange.java: Some input files use or override a deprecated API.
[INFO] /home/melnick3010/mcp-java-sdk/mcp-core/src/main/java/io/modelcontextprotocol/server/McpAsyncServerExchange.java: Recompile with -Xlint:deprecation for details.
[INFO] /home/melnick3010/mcp-java-sdk/mcp-core/src/main/java/io/modelcontextprotocol/server/McpServer.java: /home/melnick3010/mcp-java-sdk/mcp-core/src/main/java/io/modelcontextprotocol/server/McpServer.java uses unchecked or unsafe operations.
[INFO] /home/melnick3010/mcp-java-sdk/mcp-core/src/main/java/io/modelcontextprotocol/server/McpServer.java: Recompile with -Xlint:unchecked for details.
[INFO]
[INFO] --- bnd-maven-plugin:6.3.1:bnd-process (bnd-process) @ mcp-core ---
[WARNING] Cannot consider developer in line '29' of file '/home/melnick3010/mcp-java-sdk/pom.xml' for bundle header 'Bundle-Developers' as it does not contain the mandatory id.
[WARNING] Cannot consider developer in line '32' of file '/home/melnick3010/mcp-java-sdk/pom.xml' for bundle header 'Bundle-Developers' as it does not contain the mandatory id.
[WARNING] /home/melnick3010/mcp-java-sdk/mcp-core/.flattened-pom.xml [0:0]: Split package, multiple jars provide the same package:io/modelcontextprotocol/json
Use Import/Export Package directive -split-package:=(merge-first|merge-last|error|first) to get rid of this warning
Package found in   [Jar:classes, Jar:mcp-json-0.17.0-SNAPSHOT]
Class path         [Jar:classes, Jar:httpclient-4.5.13, Jar:httpcore-4.4.13, Jar:commons-logging-1.2, Jar:commons-codec-1.11, Jar:mcp-json-0.17.0-SNAPSHOT, Jar:slf4j-api-1.7.36, Jar:jackson-annotations-2.13.5, Jar:reactor-core-3.7.0, Jar:reactive-streams-1.0.4, Jar:javax.servlet-api-3.1.0]
[WARNING] /home/melnick3010/mcp-java-sdk/mcp-core/.flattened-pom.xml [0:0]: Split package, multiple jars provide the same package:io/modelcontextprotocol/json/schema
Use Import/Export Package directive -split-package:=(merge-first|merge-last|error|first) to get rid of this warning
Package found in   [Jar:classes, Jar:mcp-json-0.17.0-SNAPSHOT]
Class path         [Jar:classes, Jar:httpclient-4.5.13, Jar:httpcore-4.4.13, Jar:commons-logging-1.2, Jar:commons-codec-1.11, Jar:mcp-json-0.17.0-SNAPSHOT, Jar:slf4j-api-1.7.36, Jar:jackson-annotations-2.13.5, Jar:reactor-core-3.7.0, Jar:reactive-streams-1.0.4, Jar:javax.servlet-api-3.1.0]
[WARNING] /home/melnick3010/mcp-java-sdk/mcp-core/.flattened-pom.xml [0:0]: Unused Import-Package instructions: [jakarta.*]
[INFO]
[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ mcp-core ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 2 resources
[INFO]
[INFO] --- maven-compiler-plugin:3.11.0:testCompile (java-test-compile) @ mcp-core ---
[INFO] Changes detected - recompiling the module! :dependency
[INFO] Compiling 71 source files with javac [debug target 1.8] to target/test-classes
[INFO] /home/melnick3010/mcp-java-sdk/mcp-core/src/test/java/io/modelcontextprotocol/server/SyncToolSpecificationBuilderTest.java: Some input files use or override a deprecated API.
[INFO] /home/melnick3010/mcp-java-sdk/mcp-core/src/test/java/io/modelcontextprotocol/server/SyncToolSpecificationBuilderTest.java: Recompile with -Xlint:deprecation for details.
[INFO] /home/melnick3010/mcp-java-sdk/mcp-core/src/test/java/io/modelcontextprotocol/server/AbstractMcpClientServerIntegrationTests.java: Some input files use unchecked or unsafe operations.
[INFO] /home/melnick3010/mcp-java-sdk/mcp-core/src/test/java/io/modelcontextprotocol/server/AbstractMcpClientServerIntegrationTests.java: Recompile with -Xlint:unchecked for details.
[INFO]
[INFO] --- maven-surefire-plugin:3.1.2:test (default-test) @ mcp-core ---
[INFO] Using auto detected provider org.apache.maven.surefire.junitplatform.JUnitPlatformProvider
[INFO]
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running io.modelcontextprotocol.server.HttpServletSseIntegrationTests
[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 25.22 s <<< FAILURE! -- in io.modelcontextprotocol.server.HttpServletSseIntegrationTests
[ERROR] io.modelcontextprotocol.server.HttpServletSseIntegrationTests.testInitializeHandshake -- Time elapsed: 25.10 s <<< ERROR!
java.lang.RuntimeException: Client failed to initialize by explicit API call
        at io.modelcontextprotocol.client.LifecycleInitializer.lambda$null$2(LifecycleInitializer.java:304)
        at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onError(FluxOnErrorResume.java:94)
        at reactor.core.publisher.SerializedSubscriber.onError(SerializedSubscriber.java:124)
        at reactor.core.publisher.FluxTimeout$TimeoutMainSubscriber.handleTimeout(FluxTimeout.java:296)
        at reactor.core.publisher.FluxTimeout$TimeoutMainSubscriber.doTimeout(FluxTimeout.java:281)
        at reactor.core.publisher.FluxTimeout$TimeoutTimeoutSubscriber.onNext(FluxTimeout.java:420)
        at reactor.core.publisher.FluxOnErrorReturn$ReturnSubscriber.onNext(FluxOnErrorReturn.java:162)
        at reactor.core.publisher.MonoDelay$MonoDelayRunnable.propagateDelay(MonoDelay.java:270)
        at reactor.core.publisher.MonoDelay$MonoDelayRunnable.run(MonoDelay.java:285)
        at reactor.core.scheduler.SchedulerTask.call(SchedulerTask.java:68)
        at reactor.core.scheduler.SchedulerTask.call(SchedulerTask.java:28)
        at java.util.concurrent.FutureTask.run(FutureTask.java:266)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
        at java.lang.Thread.run(Thread.java:750)
        Suppressed: java.lang.Exception: #block terminated with an error
                at reactor.core.publisher.BlockingSingleSubscriber.blockingGet(BlockingSingleSubscriber.java:104)
                at reactor.core.publisher.Mono.block(Mono.java:1779)
                at io.modelcontextprotocol.client.McpSyncClient.initialize(McpSyncClient.java:189)
                at io.modelcontextprotocol.server.HttpServletSseIntegrationTests.testInitializeHandshake(HttpServletSseIntegrationTests.java:95)
                at java.lang.reflect.Method.invoke(Method.java:498)
                at java.util.ArrayList.forEach(ArrayList.java:1259)
                at java.util.ArrayList.forEach(ArrayList.java:1259)
Caused by: java.util.concurrent.TimeoutException: Did not observe any item or terminal signal within 20000ms in 'map' (and no fallback has been configured)
        ... 14 more

[INFO]
[INFO] Results:
[INFO]
[ERROR] Errors:
[ERROR]   HttpServletSseIntegrationTests.testInitializeHandshake Â» Runtime Client failed to initialize by explicit API call
[INFO]
[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  51.788 s
[INFO] Finished at: 2025-12-09T14:23:55-08:00
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:3.1.2:test (default-test) on project mcp-core:
[ERROR]
[ERROR] Please refer to /home/melnick3010/mcp-java-sdk/mcp-core/target/surefire-reports for the individual test results.
[ERROR] Please refer to dump files (if any exist) [date].dump, [date]-jvmRun[N].dump and [date].dumpstream.
[ERROR] -> [Help 1]
[ERROR]
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.
[ERROR]
[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException
[melnick3010@k8snv41 mcp-java-sdk]$ cat mcp-core/target/surefire-reports/io.modelcontextprotocol.server.HttpServletSseIntegrationTests-output.txt
Dec 09, 2025 2:23:31 PM org.apache.coyote.AbstractProtocol init
INFO: Initializing ProtocolHandler ["http-nio-40159"]
Dec 09, 2025 2:23:31 PM org.apache.catalina.core.StandardService startInternal
INFO: Starting service [Tomcat]
Dec 09, 2025 2:23:31 PM org.apache.catalina.core.StandardEngine startInternal
INFO: Starting Servlet engine: [Apache Tomcat/9.0.87]
Dec 09, 2025 2:23:31 PM org.apache.coyote.AbstractProtocol start
INFO: Starting ProtocolHandler ["http-nio-40159"]
Tomcat avviato su porta 40159
2025-12-09 14:23:32 [http-nio-40159-exec-2] INFO  i.m.s.t.HttpServletSseServerTransportProvider - SSE doGet() requestURI=/somePath/sse
preparo client transport (handshake)
preparo client mcp (sync, handshake)
2025-12-09 14:23:32 [http-nio-40159-exec-2] INFO  i.m.s.t.HttpServletSseServerTransportProvider - SSE endpoint event sent: http://localhost:40159/somePath/otherPath/mcp/message?sessionId=61c895c8-1263-4ad3-83e8-cef0176b530b
inizializzo client (handshake)
2025-12-09 14:23:32 [http-nio-40159-exec-3] INFO  i.m.s.t.HttpServletSseServerTransportProvider - SSE doGet() requestURI=/somePath/sse
2025-12-09 14:23:32 [http-nio-40159-exec-3] INFO  i.m.s.t.HttpServletSseServerTransportProvider - SSE endpoint event sent: http://localhost:40159/somePath/otherPath/mcp/message?sessionId=17fd75ed-8502-494c-8fbe-5f92163d5f34
2025-12-09 14:23:32 [boundedElastic-1] INFO  i.m.c.t.HttpClientSseClientTransport - SSE RAW EVENT: type=endpoint, data_lines=1, payload_len=100, preview=http://localhost:40159/somePath/otherPath/mcp/message?sessionId=17fd75ed-8502-494c-8fbe-5f92163d5f34
2025-12-09 14:23:32 [boundedElastic-1] INFO  i.m.c.t.HttpClientSseClientTransport - SSE ENDPOINT DISCOVERED (stream-local): http://localhost:40159/somePath/otherPath/mcp/message?sessionId=17fd75ed-8502-494c-8fbe-5f92163d5f34
2025-12-09 14:23:33 [main] INFO  i.m.spec.McpClientSession - CLIENT sendRequest: method=initialize, id=00111fb8-0
2025-12-09 14:23:33 [http-nio-40159-exec-4] INFO  i.m.s.t.HttpServletSseServerTransportProvider - SERVER doPost: kind=REQUEST, id=00111fb8-0, sessionId=17fd75ed-8502-494c-8fbe-5f92163d5f34, uri=/somePath/otherPath/mcp/message, thread=http-nio-40159-exec-4
2025-12-09 14:23:33 [http-nio-40159-exec-4] INFO  i.m.s.t.HttpServletSseServerTransportProvider - SERVER doPost: Starting ASYNC processing for kind=REQUEST, id=00111fb8-0, thread=http-nio-40159-exec-4
2025-12-09 14:23:33 [http-nio-40159-exec-4] INFO  i.m.spec.McpServerSession - SERVER handle(): incoming REQUEST method=initialize, id=00111fb8-0, thread=http-nio-40159-exec-4
2025-12-09 14:23:33 [http-nio-40159-exec-4] INFO  i.m.spec.McpServerSession - SERVER handle(): BEFORE handleIncomingRequest - thread=http-nio-40159-exec-4 is about to process request
2025-12-09 14:23:33 [http-nio-40159-exec-4] INFO  i.m.spec.McpServerSession - SERVER handleIncomingRequest: method=initialize, id=00111fb8-0, thread=http-nio-40159-exec-4
2025-12-09 14:23:33 [http-nio-40159-exec-4] INFO  i.m.server.McpAsyncServer - Client initialize request - Protocol: 2024-11-05, Capabilities: io.modelcontextprotocol.spec.McpSchema$ClientCapabilities@55b553a1, Info: io.modelcontextprotocol.spec.McpSchema$Implementation@506cc1d0
2025-12-09 14:23:33 [http-nio-40159-exec-4] INFO  i.m.spec.McpServerSession - SERVER prepareResponse: id=00111fb8-0, thread=http-nio-40159-exec-4 (will send via SSE)
2025-12-09 14:23:33 [boundedElastic-1] INFO  i.m.c.t.HttpClientSseClientTransport - SSE RAW EVENT: type=message, data_lines=1, payload_len=168, preview={"jsonrpc":"2.0","id":"00111fb8-0","result":{"protocolVersion":"2024-11-05","capabilities":{"logging":{}},"serverInfo":{...
2025-12-09 14:23:33 [boundedElastic-1] INFO  i.m.c.t.HttpClientSseClientTransport - SSE MESSAGE PARSED: kind=RESPONSE
2025-12-09 14:23:33 [boundedElastic-1] INFO  i.m.c.t.HttpClientSseClientTransport - DISPATCH: kind=RESPONSE -> NO POST (handled locally), thread=boundedElastic-1
2025-12-09 14:23:33 [boundedElastic-1] INFO  i.m.spec.McpClientSession - CLIENT receivedResponse: id=00111fb8-0 (completing)
2025-12-09 14:23:33 [boundedElastic-1] INFO  i.m.client.LifecycleInitializer - Server response with Protocol: 2024-11-05, Capabilities: io.modelcontextprotocol.spec.McpSchema$ServerCapabilities@15e6050d, Info: io.modelcontextprotocol.spec.McpSchema$Implementation@6d23c8a5 and Instructions null
2025-12-09 14:23:33 [boundedElastic-1] INFO  i.m.c.t.HttpClientSseClientTransport - CLIENT HANDLER OUTPUT: kind=RESPONSE, id=00111fb8-0
2025-12-09 14:23:53 [boundedElastic-3] ERROR reactor.core.publisher.Operators - Operator called default onErrorDropped
org.apache.http.impl.execchain.RequestAbortedException: Request aborted
        at org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:193)
        at org.apache.http.impl.execchain.ProtocolExec.execute(ProtocolExec.java:186)
        at org.apache.http.impl.execchain.RetryExec.execute(RetryExec.java:89)
        at org.apache.http.impl.execchain.RedirectExec.execute(RedirectExec.java:110)
        at org.apache.http.impl.client.InternalHttpClient.doExecute(InternalHttpClient.java:185)
        at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:83)
        at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:108)
        at io.modelcontextprotocol.client.transport.HttpClientSseClientTransport.lambda$null$9(HttpClientSseClientTransport.java:341)
        at reactor.core.publisher.MonoCallable.call(MonoCallable.java:72)
        at reactor.core.publisher.FluxSubscribeOnCallable$CallableSubscribeOnSubscription.run(FluxSubscribeOnCallable.java:228)
        at reactor.core.scheduler.SchedulerTask.call(SchedulerTask.java:68)
        at reactor.core.scheduler.SchedulerTask.call(SchedulerTask.java:28)
        at java.util.concurrent.FutureTask.run(FutureTask.java:266)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
        at java.lang.Thread.run(Thread.java:750)
Caused by: java.lang.InterruptedException: null
        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.reportInterruptAfterWait(AbstractQueuedSynchronizer.java:2014)
        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2048)
        at org.apache.http.pool.AbstractConnPool.getPoolEntryBlocking(AbstractConnPool.java:393)
        at org.apache.http.pool.AbstractConnPool.access$300(AbstractConnPool.java:70)
        at org.apache.http.pool.AbstractConnPool$2.get(AbstractConnPool.java:253)
        at org.apache.http.pool.AbstractConnPool$2.get(AbstractConnPool.java:198)
        at org.apache.http.impl.conn.PoolingHttpClientConnectionManager.leaseConnection(PoolingHttpClientConnectionManager.java:306)
        at org.apache.http.impl.conn.PoolingHttpClientConnectionManager$1.get(PoolingHttpClientConnectionManager.java:282)
        at org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:190)
        ... 17 common frames omitted
Chiusura risorse...
Dec 09, 2025 2:23:53 PM org.apache.coyote.AbstractProtocol pause
INFO: Pausing ProtocolHandler ["http-nio-40159"]
Dec 09, 2025 2:23:53 PM org.apache.catalina.core.StandardService stopInternal
INFO: Stopping service [Tomcat]
Dec 09, 2025 2:23:55 PM org.apache.coyote.AbstractProtocol stop
INFO: Stopping ProtocolHandler ["http-nio-40159"]
2025-12-09 14:23:55 [http-nio-40159-exec-5] WARN  i.m.s.t.HttpServletSseServerTransportProvider - Async context timed out for kind=REQUEST, id=00111fb8-0, disposing subscription
2025-12-09 14:23:55 [http-nio-40159-exec-5] WARN  i.m.s.t.HttpServletSseServerTransportProvider - Async context timed out, disposing subscription
Dec 09, 2025 2:23:55 PM org.apache.coyote.AbstractProtocol destroy
INFO: Destroying ProtocolHandler ["http-nio-40159"]
Risorse chiuse.
[melnick3010@k8snv41 mcp-java-sdk]$
